<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="/js/util.js"></script>
    <style>
        body {
            background-color: #fbf7ec;
        }

        .logo-box {
            width: 240px;
            height: 150px;
        }
    </style>
</head>

<body class="d-flex justify-content-center align-items-center vh-100">

<div class="text-center">


    <div class="logo-box d-flex justify-content-center align-items-center mx-auto mb-5">
        <img src="/image/logo.png" class="img-fluid" alt="회사 로고">
    </div>

    <h1 class="fw-bold mb-5">로그인</h1>

        <div class="row mb-3 justify-content-center">
            <label class="col-3 col-form-label text-end">아이디</label>
            <div class="col-7">
                <input type="text" id="managerId" class="form-control">
            </div>
        </div>

        <div class="row mb-3 justify-content-center">
            <label class="col-3 col-form-label text-end">비밀번호</label>
            <div class="col-7">
                <input type="password" id="pw" class="form-control">
            </div>
        </div>

        <button type="button" id="loginBtn" class="btn btn-warning px-4 mt-3">로그인</button>
</div>
<script>
    function parseAuthResponse(res) {
        const token = res.headers.get("Authorization");

        if (!res.ok) {
            throw new Error("로그인 실패");
        }
        if (!token) {
            throw new Error("토큰 없음");
        }

        return res.json().then(data => ({
            token,
            role: data.role
        }));
    }
    function loginHandling() {
        fetch("/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                managerId: $("#managerId").val(),
                pw: $("#pw").val()
            })
        })
            .then(parseAuthResponse)
            .then(result => {
                sessionStorage.setItem("au", result.token);
                sessionStorage.setItem("role", result.role);

                if (result.role === "ROLE_ADMIN" || result.role === "ROLE_MANAGER") {
                    location.href = "/manager/salesMain";
                } else {
                    location.href = "/store/storeSalesMain";
                }
            })
            .catch(err => alert(err.message));
    }
    $("#loginBtn").on("click", loginHandling);

</script>
</body>
</html>
